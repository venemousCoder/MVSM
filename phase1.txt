Perfect â€” this is exactly the right moment to reset and give your coding agent **a clean, authoritative north star**. Below is a **well-structured, copy-paste-ready master prompt** you can hand directly to your coding agent.

Iâ€™ve written it like a senior architect briefing a junior-but-capable engineer: clear goals, constraints, tech stack, and expectations. No ambiguity. No fluff. Just enough guardrails to prevent chaos ğŸ˜„.

---

# ğŸ§  **MASTER DEVELOPMENT PROMPT â€” MULTI-VENDOR SERVICE MARKETPLACE (FOUNDATION PHASE)**

## ğŸ¯ Project Overview

You are building the **foundation layer** of a **Multi-Vendor Service Marketplace**, designed to support both:

* **Retail businesses** (product listings)
* **Service businesses** (operator-based service workflows)

âš ï¸ At this stage, **NO payment gateway** is required. The system focuses on **user accounts, roles, UI structure, navigation, and authentication**.

This phase is strictly about:

* Public-facing pages
* Authentication
* Layout architecture
* Role-aware structure
* Clean, extensible Express setup

Future phases will add listings, operators, queues, scripts, etc.
**Do not overbuild beyond the scope below.**

---

## ğŸ§± Tech Stack (Non-Negotiable)

* **Node.js + Express**
* **EJS** templating engine
* **Express Layouts** (or a layout pattern using EJS includes)
* **Express-session**
* **Passport.js**
* **passport-local**
* **connect-flash** (for user-friendly messages)
* **MongoDB + Mongoose**
* **Pure CSS** (no Tailwind, no Bootstrap)

---

## ğŸ‘¥ User Roles (Core to the System)

Implement role support from day one.

### Roles:

* `consumer`
* `sme_owner`
* `operator`
* `admin`

> Only `consumer` and `sme_owner` can self-register
> `operator` accounts are **created later by SME owners**
> `admin` accounts are system-controlled

Role must be stored on the User model and accessible via `req.user.role`.

---

## ğŸ“„ Pages to Build (Preliminary Phase)

### ğŸŒ Public Pages (No Auth Required)

* `/` â†’ **Homepage**
* `/about` â†’ About the platform
* `/contact` â†’ Contact page (static form, no email handling yet)
* `/login`
* `/signup` (consumer signup)
* `/business/register` (SME owner signup)

Each page must:

* Use the global layout
* Be accessible
* Be responsive
* Display flash messages when relevant

---

## ğŸ” Authentication Requirements

### Authentication System

* Use **Passport + passport-local**
* Username field = **email**
* Password hashing via Passport Local Strategy
* Session-based authentication (NOT JWT)

### Flash Messaging

Use `connect-flash` to show:

* Login errors
* Signup validation errors
* Success messages (e.g. â€œAccount created successfullyâ€)
* Unauthorized access messages

Messages should be human-readable â€” no raw error dumps.

---

## ğŸ§© Layout & View Architecture

### Layout Strategy

Use **layouts and partials** properly.

#### Required Structure (Example)

```
views/
 â”œâ”€â”€ layouts/
 â”‚   â””â”€â”€ main.ejs
 â”œâ”€â”€ partials/
 â”‚   â”œâ”€â”€ header.ejs
 â”‚   â”œâ”€â”€ footer.ejs
 â”‚   â””â”€â”€ flash.ejs
 â”œâ”€â”€ pages/
 â”‚   â”œâ”€â”€ home.ejs
 â”‚   â”œâ”€â”€ about.ejs
 â”‚   â””â”€â”€ contact.ejs
 â”œâ”€â”€ auth/
 â”‚   â”œâ”€â”€ login.ejs
 â”‚   â”œâ”€â”€ signup.ejs
 â”‚   â””â”€â”€ signup-business.ejs
```

### Layout Responsibilities

* `main.ejs`:

  * `<head>` section
  * Navigation
  * Flash messages
  * Content slot (`<%- body %>`)
  * Footer

### Partials

* Header should be **auth-aware**:

  * Show Login/Signup if not logged in
  * Show Logout/Profile if logged in
* Flash partial should loop through:

  * `success`
  * `error`
  * `info`

---

## ğŸ§  User Model (Initial Version)

```js
User {
  name: String,
  email: { type: String, unique: true },
  password: String,
  phone: String,
  role: {
    type: String,
    enum: ['consumer', 'sme_owner', 'operator', 'admin'],
    default: 'consumer'
  },
  createdAt
}
```

âš ï¸ Do NOT add business/operator relationships yet â€” keep the schema clean and extensible.

---

## ğŸ§ª Validation Rules

* Email must be unique
* Password minimum length enforced
* Role assignment:

  * `/signup` â†’ `consumer`
  * `/business/register` â†’ `sme_owner`
* Never allow role escalation from client-side input

---

## ğŸ›¡ï¸ Middleware Expectations

Implement (even if not fully used yet):

* `ensureAuthenticated`
* `ensureRole(role)`
* `redirectIfAuthenticated` (for login/signup pages)

---

## ğŸ¨ UI/UX Expectations

* Clean, neutral, professional
* No placeholder lorem ipsum everywhere
* Clear CTAs (especially on homepage)
* Error messages should help users fix issues, not scare them

---

## ğŸš« Explicit Non-Goals (DO NOT BUILD YET)

âŒ Product listings
âŒ Service listings
âŒ Operator dashboards
âŒ Orders
âŒ Payments
âŒ Admin panels

This phase is **FOUNDATION ONLY**.

---

## âœ… Final Deliverable Expectations

At the end of this phase, the system should:

âœ” Start cleanly with no errors
âœ” Allow users to register and log in
âœ” Show flash messages correctly
âœ” Render pages using layouts and partials
âœ” Persist users in MongoDB
âœ” Support roles internally (even if not visible yet)

---

If you want, next we can:

* Design the **business onboarding flow**
* Lock down **role-based navigation**
* Or draft the **folder structure for Phase 2 (Listings + Operators)**

Just say where weâ€™re going next ğŸš€
