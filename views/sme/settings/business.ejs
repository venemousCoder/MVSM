<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">Settings: <%= business.name %></h1>
    <div class="btn-toolbar mb-2 mb-md-0">
        <a href="/sme/settings" class="btn btn-sm btn-outline-secondary">Back to Settings</a>
    </div>
</div>

<div class="row">
    <div class="col-md-8">
        <form action="/sme/business/<%= business._id %>/settings" method="POST">
            
            <!-- Business Hours -->
            <div class="card mb-4">
                <div class="card-header">Operating Hours</div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label">Weekly Schedule</label>
                        <textarea name="hours" class="form-control" rows="4" placeholder="e.g. Mon-Fri: 9AM - 5PM&#10;Sat: 10AM - 2PM&#10;Sun: Closed"><%= business.hours || '' %></textarea>
                    </div>
                </div>
            </div>

            <!-- Shipping Settings (Only for Retail) -->
            <% if (business.type === 'retail') { %>
            <div class="card mb-4">
                <div class="card-header">Shipping Configuration</div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label">Free Shipping Threshold ($)</label>
                        <input type="number" name="freeShippingThreshold" class="form-control" value="<%= business.shippingSettings ? business.shippingSettings.freeShippingThreshold : 0 %>" min="0" step="0.01">
                        <div class="form-text">Cart total required for free shipping. Set to 0 to disable.</div>
                    </div>

                    <h6 class="mt-4">Shipping Methods</h6>
                    <div id="shipping-methods-container">
                        <% if (business.shippingSettings && business.shippingSettings.methods && business.shippingSettings.methods.length > 0) { %>
                            <% business.shippingSettings.methods.forEach(function(method, index) { %>
                                <div class="row g-2 mb-2 method-row">
                                    <div class="col-md-5">
                                        <input type="text" name="shippingMethodsName[]" class="form-control form-control-sm" placeholder="Method Name (e.g. Standard)" value="<%= method.name %>" required>
                                    </div>
                                    <div class="col-md-3">
                                        <input type="number" name="shippingMethodsPrice[]" class="form-control form-control-sm" placeholder="Price ($)" value="<%= method.price %>" step="0.01" required>
                                    </div>
                                    <div class="col-md-3">
                                        <input type="text" name="shippingMethodsDuration[]" class="form-control form-control-sm" placeholder="Duration (e.g. 3-5 days)" value="<%= method.duration %>">
                                    </div>
                                    <div class="col-md-1">
                                        <button type="button" class="btn btn-sm btn-danger remove-method">&times;</button>
                                    </div>
                                </div>
                            <% }); %>
                        <% } %>
                    </div>
                    <button type="button" class="btn btn-sm btn-outline-primary mt-2" id="add-method-btn">
                        <i class="fas fa-plus"></i> Add Method
                    </button>
                </div>
            </div>
            <% } %>

            <button type="submit" class="btn btn-primary">Save Settings</button>
        </form>
    </div>
</div>

<script>
    document.getElementById('add-method-btn')?.addEventListener('click', function() {
        const container = document.getElementById('shipping-methods-container');
        const row = document.createElement('div');
        row.className = 'row g-2 mb-2 method-row';
        row.innerHTML = `
            <div class="col-md-5">
                <input type="text" name="shippingMethodsName[]" class="form-control form-control-sm" placeholder="Method Name" required>
            </div>
            <div class="col-md-3">
                <input type="number" name="shippingMethodsPrice[]" class="form-control form-control-sm" placeholder="Price ($)" step="0.01" required>
            </div>
            <div class="col-md-3">
                <input type="text" name="shippingMethodsDuration[]" class="form-control form-control-sm" placeholder="Duration">
            </div>
            <div class="col-md-1">
                <button type="button" class="btn btn-sm btn-danger remove-method">&times;</button>
            </div>
        `;
        container.appendChild(row);
    });

    document.addEventListener('click', function(e) {
        if (e.target.classList.contains('remove-method')) {
            e.target.closest('.method-row').remove();
        }
    });
</script>